<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test DiagPV Debug</title>
    <style>
        body { 
            font-family: Arial; 
            padding: 20px; 
            background: #000; 
            color: #fff; 
        }
        .form-group { 
            margin: 10px 0; 
        }
        input, button { 
            padding: 10px; 
            margin: 5px; 
            font-size: 16px; 
        }
        button { 
            background: #10b981; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
        #result { 
            margin-top: 20px; 
            padding: 10px; 
            border: 1px solid #333; 
        }
    </style>
</head>
<body>
    <h1>Test DiagPV - Cr√©ation Audit</h1>
    
    <form id="testForm">
        <div class="form-group">
            <label>Projet:</label>
            <input type="text" id="projectName" value="Test-Debug-Direct" required>
        </div>
        <div class="form-group">
            <label>Client:</label>
            <input type="text" id="clientName" value="Client Test" required>
        </div>
        <div class="form-group">
            <label>Location:</label>
            <input type="text" id="location" value="Test Location" required>
        </div>
        <div class="form-group">
            <label>Strings:</label>
            <input type="number" id="stringCount" value="2" required>
        </div>
        <div class="form-group">
            <label>Modules/String:</label>
            <input type="number" id="modulesPerString" value="5" required>
        </div>
        <button type="submit">CR√âER AUDIT TEST</button>
    </form>
    
    <div id="result"></div>
    
    <script>
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault()
            
            const resultDiv = document.getElementById('result')
            resultDiv.innerHTML = '‚è≥ Cr√©ation en cours...'
            
            console.log('üöÄ Test cr√©ation audit d√©marr√©')
            
            try {
                const auditData = {
                    projectName: document.getElementById('projectName').value,
                    clientName: document.getElementById('clientName').value,
                    location: document.getElementById('location').value,
                    auditDate: new Date().toISOString().split('T')[0],
                    stringCount: parseInt(document.getElementById('stringCount').value),
                    modulesPerString: parseInt(document.getElementById('modulesPerString').value)
                }
                
                console.log('üì° Donn√©es √† envoyer:', auditData)
                
                const response = await fetch('/api/audit/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(auditData)
                })
                
                console.log('üì• R√©ponse status:', response.status)
                
                const result = await response.json()
                console.log('‚úÖ R√©sultat:', result)
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <h3>‚úÖ SUCC√àS!</h3>
                        <p><strong>Token:</strong> ${result.auditToken}</p>
                        <p><strong>URL:</strong> <a href="${result.auditUrl}" style="color: #10b981">${result.auditUrl}</a></p>
                        <p><strong>Modules:</strong> ${result.totalModules}</p>
                        <button onclick="window.location.href='${result.auditUrl}'" style="margin-top: 10px;">
                            üéØ ALLER √Ä L'AUDIT
                        </button>
                    `
                } else {
                    resultDiv.innerHTML = `‚ùå √âchec: ${result.message || 'Erreur inconnue'}`
                }
                
            } catch (error) {
                console.error('‚ùå Erreur:', error)
                resultDiv.innerHTML = `‚ùå Erreur: ${error.message}`
            }
        })
        
        console.log('üåô DiagPV Debug Test initialis√©')
    </script>
</body>
</html>